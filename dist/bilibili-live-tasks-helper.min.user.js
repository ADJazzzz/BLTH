// ==UserScript==
// @name         Bilibili Live Tasks Helper
// @namespace    https://github.com/andywang425
// @version      7.0.0
// @author       andywang425
// @description  优化B站直播观看体验
// @license      MIT
// @copyright    2023, andywang425 (https://github.com/andywang425)
// @icon         data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDEuMDY1IiBoZWlnaHQ9IjEyNy43NDciIHZpZXdCb3g9IjAgMCAzNy4zMjQgMzMuOCI+PHBhdGggZmlsbD0iIzIwYjBlMyIgZD0iTTg2Ljk2MiAxMTIuMzMyYTIuNjYxIDIuNjYxIDAgMCAxIDIuMjYyIDAgNS41MzYgNS41MzYgMCAwIDEgMS4zODQgMS4wMTFsNS4zMjMgNC42NThoMy44MDVsNS4zMjMtNC42NThhNS41ODkgNS41ODkgMCAwIDEgMS4zODQtMS4wMTEgMi42NjEgMi42NjEgMCAwIDEgMy41NCAyLjIwOSAyLjY2MSAyLjY2MSAwIDAgMS0uNTg2IDEuNzgzIDE0Ljg3NyAxNC44NzcgMCAwIDEtMS4xNzEgMS4wNjUgNy42OTEgNy42OTEgMCAwIDEtLjc0NS42MTJoMy4zMjZhNS42NDIgNS42NDIgMCAwIDEgMy45MTIgMS43NTYgNS42NjkgNS42NjkgMCAwIDEgMS43ODQgMy45MTJ2MTUuMzAzYTEwLjc3OCAxMC43NzggMCAwIDEtLjEzNCAyLjMxNSA1LjkwOCA1LjkwOCAwIDAgMS0yLjY2IDMuNzI2IDUuNzIyIDUuNzIyIDAgMCAxLTMuMDYxLjg1Mkg4Ni4yMTdhMTEuMjg0IDExLjI4NCAwIDAgMS0yLjM5Ni0uMTMzIDUuODgyIDUuODgyIDAgMCAxLTMuNjcyLTIuNjYyIDUuNjk1IDUuNjk1IDAgMCAxLS45MDUtMy4wNnYtMTUuMTQzYTExLjkyMyAxMS45MjMgMCAwIDEgMC0yLjIwOSA1Ljg1NSA1Ljg1NSAwIDAgMSA1LjMyMy00LjczN2gzLjQ4NmMtLjU1OS0uNC0xLjAzOC0uODc4LTEuNTQ0LTEuMzA0YTIuNjYxIDIuNjYxIDAgMCAxLS44NTEtMi4xODMgMi42NjEgMi42NjEgMCAwIDEgMS4zMDQtMi4xMDJtLS42MTIgMTAuMzI2YTIuNjYxIDIuNjYxIDAgMCAwLTIuMTAzIDEuOTE2IDMuNTkzIDMuNTkzIDAgMCAwIDAgMS4wMTF2MTIuNTg4YTIuNjYxIDIuNjYxIDAgMCAwIDEuODM3IDIuNjYyIDMuNTEzIDMuNTEzIDAgMCAwIDEuMTQ0LjE4NmgyMS42MzdhMi42NjEgMi42NjEgMCAwIDAgMi41MjgtMS41NyAzLjcyNiAzLjcyNiAwIDAgMCAuMjY2LTEuNzU3di0xMS43MWE0LjQ3MSA0LjQ3MSAwIDAgMCAwLTEuMjc3IDIuNjYxIDIuNjYxIDAgMCAwLTEuNzMtMS44MSA0LjI4NSA0LjI4NSAwIDAgMC0xLjY1LS4yMzlIODcuNjAxYTguODg5IDguODg5IDAgMCAwLTEuMjUxIDB6bTAgMCIgc3R5bGU9InN0cm9rZS13aWR0aDouMDMzMDcyOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc5LjE5MyAtMTEyLjA4KSIvPjxwYXRoIGQ9Ik04OC45NyAxMjguNjM2Yy4zNjMuMzc3Ljc0NS43NDcgMS4wODggMS4xNDIuNTk3LjY4NyAxLjExOCAxLjE5NyAxLjY2NiAxLjgwOS0uMTI5LTEuMTE3IDEuMzA0LTEuMTk4LjA3NC0xLjc1Ny0uNDA4LjQxNy0uOTQxLjg4NC0xLjM2IDEuMjIzLS4zOTIuMzE2LS44NjMuNjctMS4yMzUuOTUyLTEuOTA3IDEuNDQzLjIyNiA0LjA1MyAyLjEzIDIuNjA3IDAgMCAyLTEuNTM1IDIuODA3LTIuMzAxLjQ0LS40MTcuNjgtLjk1Ni43Mi0xLjU5Mi4wNC0uNjU0LS41MzUtMS4yNC0uNzk0LTEuNDk4LS45Mi0uOTE0LTEuNzQzLTEuOTY4LTIuNTUtMi44MTItMS41NzUtMS44LTQuMTIuNDI4LTIuNTQ2IDIuMjI3ek0xMDYuOTc5IDEyOC42MzZjLS4zNjMuMzc3LS43NDUuNzQ3LTEuMDg4IDEuMTQyLS41OTcuNjg3LTEuMTE4IDEuMTk3LTEuNjY2IDEuODA5LjEyOS0xLjExNy0xLjMwNC0xLjE5OC0uMDc0LTEuNzU3LjQwOC40MTcuOTQxLjg4NCAxLjM2IDEuMjIzLjM5Mi4zMTYuODYzLjY3IDEuMjM1Ljk1MiAxLjkwNyAxLjQ0My0uMjI2IDQuMDUzLTIuMTMgMi42MDcgMCAwLTItMS41MzUtMi44MDctMi4zMDEtLjQ0LS40MTctLjY4LS45NTYtLjcyLTEuNTkyLS4wNC0uNjU0LjUzNS0xLjI0Ljc5NC0xLjQ5OC45Mi0uOTE0IDEuNzQzLTEuOTY4IDIuNTUtMi44MTIgMS41NzUtMS44IDQuMTIuNDI4IDIuNTQ2IDIuMjI3eiIgc3R5bGU9ImZpbGw6IzIwYjBlMztmaWxsLW9wYWNpdHk6MTtzdHJva2Utd2lkdGg6LjUyNDE1OTtzdHJva2UtZGFzaGFycmF5Om5vbmUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03OS4xOTMgLTExMi4wOCkiLz48L3N2Zz4NCg==
// @homepageURL  https://github.com/andywang425/BLTH
// @supportURL   https://github.com/andywang425/BLTH/issues
// @include      /^https?:\/\/live\.bilibili\.com\/(blanc\/)?\d+\??.*$/
// @require      https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js
// @require      data:application/javascript,window.Vue%3DVue%2Cwindow.VueDemi%3DVue%3B
// @require      https://unpkg.com/element-plus@2.3.8/dist/index.full.min.js
// @require      https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js
// @require      https://unpkg.com/pinia@2.1.4/dist/pinia.iife.prod.js
// @require      https://unpkg.com/lodash@4.17.21/lodash.min.js
// @require      https://unpkg.com/hotkeys-js@3.11.2/dist/hotkeys.min.js
// @require      https://unpkg.com/luxon@3.3.0/build/global/luxon.min.js
// @require      https://unpkg.com/crypto-js@4.1.1/crypto-js.js
// @resource     element-plus/dist/index.css  https://unpkg.com/element-plus@2.3.8/dist/index.css
// @connect      api.bilibili.com
// @connect      api.live.bilibili.com
// @connect      api.vc.bilibili.com
// @connect      passport.bilibili.com
// @connect      live.bilibili.com
// @connect      live-trace.bilibili.com
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==
(e=>{const t=document.createElement("style");t.dataset.source="vite-plugin-monkey",t.textContent=" .title[data-v-dda95e10]{padding-left:20px;align-items:center;display:flex}.header-big-text[data-v-dda95e10]{font-size:var(--big-text-size)}.header-small-text[data-v-dda95e10]{font-size:var(--small-text-size);padding-top:calc(var(--big-text-size) - var(--small-text-size));margin-left:10px;--small-text-size: 18px}.collapse-btn[data-v-dda95e10]{display:flex;justify-content:center;align-items:center;height:100%;float:left;cursor:pointer}.base[data-v-64fce103]{z-index:1003;position:absolute;background-color:#fff;border-bottom:1px solid #e3e5e7;border-left:1px solid #e3e5e7;border-right:1px solid #e3e5e7}.header[data-v-64fce103]{position:relative;box-sizing:border-box;width:100%;font-size:var(--big-text-size);align-items:center;display:flex;border-bottom:1px solid #e3e5e7;height:60px;--big-text-size: 25px}.aside[data-v-64fce103]{width:auto}.aside #aside-el-menu[data-v-64fce103]:not(.el-menu--collapse){width:150px}.main[data-v-64fce103]{--main-top-botton-padding: calc(var(--el-main-padding) * .625);padding-top:var(--main-top-botton-padding);padding-bottom:var(--main-top-botton-padding)}.fade-enter-active[data-v-64fce103],.fade-leave-active[data-v-64fce103]{transition:opacity .1s ease}.fade-enter-from[data-v-64fce103],.fade-leave-to[data-v-64fce103]{opacity:0}.info-icon[data-v-c1d8df5e]{font-size:var(--el-font-size-base);cursor:pointer}.status-icon[data-v-2f9d6050]{font-size:var(--el-font-size-base)}.blth_btn{background-color:#23ade5;font-size:small;margin-inline-start:5px;color:#fff;border-radius:4px;border:none;padding:5px;cursor:pointer;box-shadow:0 0 2px #00000075;line-height:10px;margin-left:15px}.blth_btn:hover{background-color:#1097cc}.blth_btn:hover:active{background-color:#0e86b6;position:relative;top:1px}.el-link-va-baseline{vertical-align:baseline} ",document.head.append(t)})(),function(e,t,s,i,o,a,n,l){"use strict";function r(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const s in e)if("default"!==s){const i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>e[s]})}return t.default=e,Object.freeze(t)}const c=r(a);var d=Object.defineProperty,u=(e,t,s)=>(((e,t,s)=>{t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s),h=(()=>"undefined"!=typeof GM_getValue?GM_getValue:void 0)(),g=(()=>"undefined"!=typeof GM_setValue?GM_setValue:void 0)(),m=(()=>"undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:void 0)(),f=(()=>"undefined"!=typeof unsafeWindow?unsafeWindow:void 0)();const p={ui:{isCollapse:!1,isShowPanel:!0,activeMenuIndex:"MainSiteTasks"},modules:{DailyTasks:{MainSiteTasks:{login:{enabled:!1,_lastCompleteTime:0},watch:{enabled:!1,_lastCompleteTime:0},coin:{enabled:!1,num:1,_lastCompleteTime:0},share:{enabled:!1,_lastCompleteTime:0}},LiveTasks:{sign:{enabled:!1,_lastCompleteTime:0},danmu:{enabled:!1,list:["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","╮(￣▽￣)╭","_(:3」∠)_","(^・ω・^ )","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","←◡←","(●'◡'●)ﾉ♥"],_lastCompleteTime:0},like:{enabled:!1,_lastCompleteTime:0},watch:{enabled:!1,time:70,_watchedSecondsToday:0,_lastWatchTime:0,_lastCompleteTime:0},appUser:{enabled:!1,_lastCompleteTime:0}},OtherTasks:{groupSign:{enabled:!1,_lastCompleteTime:0},silverToCoin:{enabled:!1,_lastCompleteTime:0},coinToSilver:{enabled:!1,num:1,_lastCompleteTime:0}}}}};class v{static mergeConfigs(e,t){const i=s.difference(s.keys(e),s.keys(t));e=s.omit(e,i);const o=s.difference(s.keys(t),s.keys(e));s.assign(e,s.pick(t,o));for(const[i,a]of Object.entries(e).filter((e=>!o.includes(e[0]))))s.isPlainObject(a)&&(e[i]=this.mergeConfigs(a,t[i]));return e}static setUiConfig(e){g("ui",e)}static getUiConfig(){return this.mergeConfigs(h("ui",{}),p.ui)}static setModuleConfig(e){g("modules",e)}static getModuleConfig(){return this.mergeConfigs(h("modules",{}),p.modules)}}const T=t.defineStore("ui",(()=>{const t=e.reactive(v.getUiConfig()),i=e.computed((()=>({MainSiteTasks:"主站任务",LiveTasks:"直播任务",OtherTasks:"其它任务"}[t.activeMenuIndex]))),o=e.reactive({top:0,left:0,height:0,width:0}),a=e.computed((()=>({top:o.top.toString()+"px",left:o.left.toString()+"px",height:o.height.toString()+"px",width:o.width.toString()+"px"}))),n=e.computed((()=>t.isShowPanel?"隐藏控制面板":"显示控制面板")),l=e.computed((()=>(o.height-60).toString()+"px"));return e.watch(t,s.debounce((e=>v.setUiConfig(e)),350)),{isShowPanelButtonText:n,activeMenuName:i,baseStyleValue:o,baseStyle:a,scrollBarHeight:l,uiConfig:t,changeCollapse:function(){t.isCollapse=!t.isCollapse},changeShowPanel:function(){t.isShowPanel=!t.isShowPanel},setActiveMenuIndex:function(e){t.activeMenuIndex=e}}})),w=t.defineStore("bili",(()=>{const t=e.ref(),s=e.ref(),i=e.ref(),o=e.ref(),a=e.ref(),n=e.ref(),l=e.ref(),r=e.computed((()=>l.value?l.value.filter((e=>"账号已注销"!==e.anchor_info.nick_name&&0!==e.room_info.room_id)):null));return{BilibiliLive:t,userInfo:i,giftConfig:o,cookies:s,dailyRewardInfo:a,dynamicVideos:n,fansMedals:l,filteredFansMedals:r}}));class k{constructor(e,t){u(this,"url_prefix"),u(this,"origin"),this.url_prefix=e??"",this.origin=t??"https://bilibili.com"}get(e,t,i){return new Promise(((o,a)=>{const n={method:"GET",url:this.url_prefix+e+(t?"?"+new URLSearchParams(t).toString():""),responseType:"json",headers:{Accept:"application/json, text/plain, */*",Referer:this.origin,Origin:this.origin,"Sec-Fetch-Site":"same-site"},onload:function(e){o(e.response)},onerror:function(e){a(e)}},l=s.defaultsDeep(i,n);m(l)}))}post(e,t,i){return new Promise(((o,a)=>{const n={method:"POST",url:this.url_prefix.concat(e),data:new URLSearchParams(t).toString(),responseType:"json",headers:{Accept:"application/json, text/plain, */*",Referer:this.origin,Origin:this.origin,"Sec-Fetch-Site":"same-site","Content-Type":"application/x-www-form-urlencoded"},onload:function(e){o(e.response)},onerror:function(e){a(e)}},l=s.defaultsDeep(i,n);"multipart/form-data"===l.headers["Content-Type"]&&delete l.headers["Content-Type"],m(l)}))}}function _(e){return new Promise((t=>setTimeout(t,e)))}function y(e){const t=new FormData;return s.forEach(e,((e,s)=>t.append(s,e.toString()))),t}function x(e,t,i){s.forOwn(e,(function(e,o){const a=i?i+"."+o:o;s.isPlainObject(e)&&!s.isEmpty(e)?x(e,t,a):t(e,a)}))}function b(e,t=0,s=5){const o=i.DateTime.fromMillis(e),a=i.DateTime.now().set({hour:t,minute:s,second:0,millisecond:0}),n=a.plus({days:1}),l=a.minus({days:1});return i.DateTime.now()>=a?o>=a&&o<n:o>=l&&o<a}function C(e=0,t=5){const s=i.DateTime.now();let o=i.DateTime.local(s.year,s.month,s.day,e,t);s>o&&(o=o.plus({days:1}));const a=o.diff(s);return{ms:a.toMillis(),str:a.toFormat("h小时m分钟s秒").replace(/^0小时/,"").replace(/^0分钟/,"")}}function V(e,t,s,o){const a=i.DateTime.now(),n=i.DateTime.local(a.year,a.month,a.day,e,t),l=i.DateTime.local(a.year,a.month,a.day,s,o);return a>=n&&a<l}function S(){return Math.round(i.DateTime.now().toSeconds())}function N(){return i.DateTime.now().toMillis()}i.Settings.defaultZone="Asia/Shanghai";const I={live:new k("https://api.live.bilibili.com","https://live.bilibili.com"),liveTrace:new k("https://live-trace.bilibili.com","https://live.bilibili.com"),passport:new k("https://passport.bilibili.com","https://passport.bilibili.com/"),main:new k("https://api.bilibili.com","https://www.bilibili.com"),vc:new k("https://api.vc.bilibili.com","https://message.bilibili.com/"),raw:new k},B={roomGiftConfig:(e=0,t=0,s=0,i="pc")=>I.live.get("/xlive/web-room/v1/giftPanel/roomGiftConfig",{platform:i,room_id:e,area_parent_id:t,area_id:s}),doSign:()=>I.live.get("/xlive/web-ucenter/v1/sign/DoSign"),getSignInfo:()=>I.live.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo"),fansMedalPanel:(e,t=10)=>I.live.get("/xlive/app-ucenter/v1/fansMedal/panel",{page:e,page_size:t},{Origin:"https://link.bilibili.com",Referer:"https://link.bilibili.com/p/center/index"}),sendMsg:(e,t,s=0,i=1,o=0,a=25,n=16777215,l=0)=>{const r=w().cookies.bili_jct;return I.live.post("/msg/send",void 0,{data:y({roomid:t,room_type:s,rnd:S(),msg:e,mode:i,jumpfrom:o,fontsize:a,csrf:r,csrf_token:r,color:n,bubble:l}),headers:{"Content-Type":"multipart/form-data"}})},likeReport:(e,t)=>{const s=w().cookies.bili_jct;return I.live.post("/xlive/app-ucenter/v1/like_info_v3/like/likeReportV3",{room_id:e,anchor_id:t,uid:t,ts:S(),csrf:s})},getInfoByRoom:e=>I.live.get("/xlive/web-room/v1/index/getInfoByRoom",{room_id:e}),getUserTaskProgress:(e=11153765)=>{const t=w().cookies.bili_jct;return I.live.get("/xlive/app-ucenter/v1/userTask/GetUserTaskProgress",{target_id:e,csrf:t,ts:S()})},userTaskReceiveRewards:(e=11153765)=>{const t=w().cookies.bili_jct;return I.live.post("/xlive/app-ucenter/v1/userTask/UserTaskReceiveRewards",{actionKey:"csrf",target_id:e,csrf:t,ts:S()})},silver2coin:(e="")=>{const t=w().cookies.bili_jct;return I.live.post("/xlive/revenue/v1/wallet/silver2coin",{csrf:t,csrf_token:t,visit_id:e})},coin2silver:(e,t="pc",s="")=>{const i=w().cookies.bili_jct;return I.live.post("/xlive/revenue/v1/wallet/coin2silver",{num:e,csrf:i,csrf_token:i,platform:t,visit_id:s})}},D={E:(e,t,s,i=0,o=[],a="")=>{const n=w().cookies.bili_jct;return I.liveTrace.post("/xlive/data-interface/v1/x25Kn/E",{id:JSON.stringify(e),device:JSON.stringify(t),ruid:s,ts:N(),is_patch:i,heart_beat:JSON.stringify(o),ua:navigator.userAgent,csrf_token:n,csrf:n,visit_id:a})},X:(e,t,s,i,o,a,n,l,r="")=>{const c=w().cookies.bili_jct;return I.liveTrace.post("/xlive/data-interface/v1/x25Kn/X",{s:e,id:JSON.stringify(t),device:JSON.stringify(s),ruid:i,ets:o,benchmark:a,time:n,ts:l,ua:navigator.userAgent,csrf_token:c,csrf:c,visit_id:r})}},P={nav:()=>I.main.get("/x/web-interface/nav"),reward:()=>I.main.get("/x/member/web/exp/reward"),dynamicAll:(e,t=1,s=-480,i="itemOpusStyle")=>I.main.get("/x/polymer/web-dynamic/v1/feed/all",{timezone_offset:s,type:e,page:t,features:i}),videoHeartbeat:(e,t="",s=0,i=0,o=0,a="https://t.bilibili.com/?spm_id_from=444.3.0.0",n=116,l=100,r=3,c=0,d=0,u=2,h=0,g=0,m="333.488.0.0",f="333.31.list.card_archive.click",p='{"player_version":"4.1.21-rc.1727.0"}')=>{const v=w();return I.main.post("/x/click-interface/web/heartbeat",{start_ts:S(),mid:w().BilibiliLive.UID,aid:e,cid:t,type:r,sub_type:c,dt:u,play_type:d,realtime:s,played_time:i,real_played_time:o,refer_url:a,quality:n,video_duration:l,last_play_progress_time:h,max_play_progress_time:g,spmid:m,from_spmid:f,extra:p,csrf:v.cookies.bili_jct})},share:(e,t="pc_client_normal",s=2,i=0,o=1)=>{const a=w().cookies.bili_jct;return I.main.post("/x/web-interface/share/add",{aid:e,eab_x:s,ramval:i,source:t,ga:o,csrf:a})},coinAdd:(e,t,s=0,i=!0,o=2,a=6,n="web_normal",l=1)=>{const r=w().cookies.bili_jct;return I.main.post("/x/web-interface/coin/add ",{aid:e,multiply:t,select_like:s,cross_domain:i,eab_x:o,ramval:a,source:n,ga:l,csrf:r})},videoRelation:(e,t="")=>I.main.get("/x/web-interface/archive/relation",{aid:e,bvid:t})},M={myGroups:(e=0,t="web")=>I.vc.get("/link_group/v1/member/my_groups",{build:e,mobi_app:t}),signIn:(e,t)=>I.vc.get("/link_setting/v1/link_setting/sign_in",{group_id:e,owner_id:t})};class ${constructor(e){u(this,"NAME","BLTH"),u(this,"prefix_title_str"),u(this,"_title"),this._title=e,this.prefix_title_str=e.split("_").join("][")}get prefix(){return[`%c${this.NAME}%c[${(new Date).toLocaleString()}]%c[${this.prefix_title_str}]%c:`,"font-weight: bold; color: white; background-color: #23ade5; padding: 1px 4px; border-radius: 4px;","font-weight: bold; color: #0920e6;","font-weight: bold;",""]}log(...e){console.log(...this.prefix,...e)}error(...e){console.error(...this.prefix,...e)}warn(...e){console.warn(...this.prefix,...e)}}class A{constructor(e){u(this,"moduleName"),u(this,"logger"),u(this,"moduleStore",F()),u(this,"config"),this.moduleName=e,this.logger=new $(this.moduleName)}set status(e){throw new Error("Method not implemented.")}run(){throw new Error("Method not implemented.")}}class L extends A{run(){throw new Error("Method not implemented.")}}u(L,"sequence");class O extends L{getBilibiliLive(){return this.logger.log("unsafeWindow.BilibiliLive",f.BilibiliLive),f.BilibiliLive}getCookies(){return function(e){const t={};for(const s of e)t[s]=null;for(const s of document.cookie.split("; ")){for(let i=0;i<e.length;i++){const o=e[i],a=o+"=";if(s.startsWith(a)){const n=s.substring(a.length);t[o]=decodeURIComponent(n),e.splice(i,1);break}}if(0===e.length)break}return t}(["bili_jct"])}async getUserInfo(){try{const e=await P.nav();return this.logger.log("BAPI.main.nav response",e),0===e.code?Promise.resolve(e.data):(this.logger.error("获取用户信息失败",e.message),Promise.reject(e.message))}catch(e){return this.logger.error("获取用户信息出错",e),Promise.reject(e)}}async getGiftConfig(){try{throw new Error("送礼功能尚未完成，暂时不需要获取礼物配置信息，请忽略本报错 ＞︿＜")}catch(e){return this.logger.error("获取礼物配置信息出错",e),Promise.reject(e)}}async getDailyRewardInfo(){const e=this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks;if(!Object.values(e).some((e=>e.enabled&&!b(e._lastCompleteTime))))return Promise.reject();try{const e=await P.reward();return this.logger.log("BAPI.main.reward response",e),0===e.code?Promise.resolve(e.data):(this.logger.error("获取主站每日任务完成情况失败",e.message),Promise.reject(e.message))}catch(e){return this.logger.error("获取主站每日任务完成情况出错",e),Promise.reject(e)}}async getDynamicVideo(){const e=this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks;if(!Object.entries(e).filter((([e])=>["watch","share","coin"].includes(e))).some((e=>e[1].enabled&&!b(e[1]._lastCompleteTime))))return Promise.reject();try{const e=await P.dynamicAll("video");return this.logger.log("BAPI.main.dynamicAll response",e),0===e.code?Promise.resolve(e.data.items):(this.logger.error("获取主站每日任务完成情况失败",e.message),Promise.reject(e.message))}catch(e){return this.logger.error("获取主站每日任务完成情况出错",e),Promise.reject(e)}}async getFansMetals(e=10){const t=this.moduleStore.moduleConfig.DailyTasks.LiveTasks;if(!Object.entries(t).filter((([e])=>["danmu","like","watch"].includes(e))).some((e=>e[1].enabled&&!b(e[1]._lastCompleteTime))))return Promise.reject();{const t=[];let s=1;try{const i=await B.fansMedalPanel(1);if(this.logger.log("BAPI.live.fansMedalPanel(1) response",i),0!==i.code)return this.logger.error("获取粉丝勋章列表第1页失败",i.message),Promise.reject(i.message);s=i.data.page_info.total_page,t.push(...i.data.special_list,...i.data.list);for(let o=2;o<=Math.min(s,e);o++){const e=await B.fansMedalPanel(o);if(this.logger.log(`BAPI.live.fansMedalPanel(${o}) response`,e),0!==i.code)return this.logger.error(`获取粉丝勋章列表第${o}页失败`,i.message),t;t.push(...e.data.list),await _(250)}return Promise.resolve(t)}catch(e){return Promise.reject(e)}}}async run(){const e=w();e.BilibiliLive=this.getBilibiliLive(),e.cookies=this.getCookies(),e.userInfo=await this.getUserInfo(),setTimeout((async()=>{e.userInfo=await this.getUserInfo()}),C(0,4).ms);const t=await Promise.allSettled([this.getGiftConfig(),this.getDailyRewardInfo(),this.getDynamicVideo(),this.getFansMetals()]);this.logger.log("allPromiseResult",t),e.giftConfig="fulfilled"===t[0].status?t[0].value:null,e.dailyRewardInfo="fulfilled"===t[1].status?t[1].value:null,setTimeout((async()=>{const e=w();e.dailyRewardInfo&&(e.dailyRewardInfo.login=!1,e.dailyRewardInfo.share=!1,e.dailyRewardInfo.watch=!1,e.dailyRewardInfo.coins=0),e.dailyRewardInfo=await this.getDailyRewardInfo()}),C(0,4).ms),e.dynamicVideos="fulfilled"===t[2].status?t[2].value:null,setTimeout((async()=>{e.dynamicVideos=await this.getDynamicVideo()}),C(0,4).ms),e.fansMedals="fulfilled"===t[3].status?t[3].value:null,setTimeout((async()=>{e.fansMedals=await this.getFansMetals()}),C(0,4).ms)}}u(O,"sequence",0);const R=Object.freeze(Object.defineProperty({__proto__:null,BiliInfo:O},Symbol.toStringTag,{value:"Module"}));const E=document.querySelector.bind(document);document.querySelectorAll.bind(document);const U=document.createElement.bind(document);class j{constructor(e,t,s,i,o,a=!1){u(this,"logger",new $("RoomHeart")),u(this,"config"),u(this,"isLast"),u(this,"watchedSeconds"),u(this,"timer"),u(this,"stop",!1),u(this,"areaID"),u(this,"parentID"),u(this,"roomID"),u(this,"ruid"),u(this,"seq",0),u(this,"buvid",function(e){const t=e+"=";for(const e of document.cookie.split("; "))if(e.startsWith(t)){const s=e.substring(t.length);return decodeURIComponent(s)}return null}("LIVE_BUVID")),u(this,"uuid","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))),u(this,"device",[this.buvid,this.uuid]),u(this,"ua",navigator.userAgent),u(this,"heartBeatInterval"),u(this,"secretKey"),u(this,"secretRule"),u(this,"timestamp"),this.roomID=e,this.areaID=t,this.parentID=s,this.ruid=i,this.watchedSeconds=o,this.isLast=a,this.config=F().moduleConfig.DailyTasks.LiveTasks.watch}set status(e){F().moduleStatus.DailyTasks.LiveTasks.watch=e}get id(){return[this.parentID,this.areaID,this.seq,this.roomID]}start(){if(this.buvid)return this.timer=setTimeout((()=>this.stop=!0),C(0,0).ms),this.E()}async E(){if(this.stop)this.status="";else try{const e=await D.E(this.id,this.device,this.ruid);this.logger.log(`BAPI.liveTrace.E(${this.id}, ${this.device}, ${this.ruid}) response`,e),0===e.code?(this.seq+=1,({heartbeat_interval:this.heartBeatInterval,secret_key:this.secretKey,secret_rule:this.secretRule,timestamp:this.timestamp}=e.data),setTimeout((()=>this.X()),1e3*this.heartBeatInterval)):this.logger.error(`BAPI.liveTrace.E(${this.id}, ${this.device}, ${this.ruid}) 失败`,e.message)}catch(e){this.logger.error(`BAPI.liveTrace.E(${this.id}, ${this.device}, ${this.ruid}) 出错`,e)}}async X(){if(this.stop)this.status="";else try{const e={id:JSON.stringify(this.id),device:JSON.stringify(this.device),ets:this.timestamp,benchmark:this.secretKey,time:this.heartBeatInterval,ts:N(),ua:this.ua},t=this.sypder(JSON.stringify(e),this.secretRule),s=await D.X(t,this.id,this.device,this.ruid,this.timestamp,this.secretKey,this.heartBeatInterval,e.ts);if(this.logger.log(`BAPI.liveTrace.X(${t}, ${this.id}, ${this.device}, ${this.ruid}, ${this.timestamp}, ${this.secretKey}, ${this.heartBeatInterval}, ${e.ts}) response`,s),0===s.code){if(this.seq+=1,this.watchedSeconds+=this.heartBeatInterval,this.isLast&&(this.config._watchedSecondsToday=this.watchedSeconds),this.watchedSeconds>=60*this.config.time)return this.isLast&&(this.config._lastCompleteTime=N(),this.logger.log("观看直播任务已完成"),this.status="done"),void clearTimeout(this.timer);({heartbeat_interval:this.heartBeatInterval,secret_key:this.secretKey,secret_rule:this.secretRule,timestamp:this.timestamp}=s.data),setTimeout((()=>this.X()),1e3*this.heartBeatInterval)}else this.logger.error(`BAPI.liveTrace.X(${t}, ${this.id}, ${this.device}, ${this.ruid}, ${this.timestamp}, ${this.secretKey}, ${this.heartBeatInterval}) 失败`,s.message)}catch(e){this.logger.error(`BAPI.liveTrace.X(s, ${this.id}, ${this.device}, ${this.ruid}, ${this.timestamp}, ${this.secretKey}, ${this.heartBeatInterval}) 出错`,e)}}sypder(e,t){const s=JSON.parse(e),[i,a,n,l]=JSON.parse(s.id),[r,c]=JSON.parse(s.device),d=s.benchmark,u={platform:"web",parent_id:i,area_id:a,seq_id:n,room_id:l,buvid:r,uuid:c,ets:s.ets,time:s.time,ts:s.ts};let h=JSON.stringify(u);for(const e of t)switch(e){case 0:default:h=o.HmacMD5(h,d).toString(o.enc.Hex);break;case 1:h=o.HmacSHA1(h,d).toString(o.enc.Hex);break;case 2:h=o.HmacSHA256(h,d).toString(o.enc.Hex);break;case 3:h=o.HmacSHA224(h,d).toString(o.enc.Hex);break;case 4:h=o.HmacSHA512(h,d).toString(o.enc.Hex);break;case 5:h=o.HmacSHA384(h,d).toString(o.enc.Hex)}return h}}const z=Object.freeze(Object.defineProperty({__proto__:null,DailyTask_LiveTask_AppUserTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.LiveTasks.appUser)}set status(e){this.moduleStore.moduleStatus.DailyTasks.LiveTasks.appUser=e}async getUserTaskProgress(){try{const e=await B.getUserTaskProgress();return this.logger.log("BAPI.live.getUserTaskProgress response",e),0===e.code?e.data:(this.logger.error("获取APP用户任务进度失败",e.message),this.status="error",null)}catch(e){return this.logger.error("获取APP用户任务进度出错",e),this.status="error",null}}async userTaskReceiveRewards(){try{const e=await B.userTaskReceiveRewards();return this.logger.log("BAPI.live.userTaskReceiveRewards response",e),0===e.code?e.data:(this.logger.error("获取APP用户任务进度失败",e.message),this.status="error",null)}catch(e){return this.logger.error("获取APP用户任务进度出错",e),this.status="error",null}}async sendDanmu(e,t){try{const s=await B.sendMsg(e,t);this.logger.log(`BAPI.live.sendMsg(${e}, ${t})`,s),0===s.code?this.logger.log(`在直播间 ${t} 发送弹幕 ${e} 成功`):this.logger.error(`在直播间 ${t} 发送弹幕 ${e} 失败`,s.message)}catch(s){this.logger.error(`在直播间 ${t} 发送弹幕 ${e} 出错`,s)}}async run(){if(this.logger.log("APP用户任务模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的APP用户任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过APP用户任务了"),this.status="done");else{this.status="running";const e=this.moduleStore.moduleConfig.DailyTasks.LiveTasks.danmu;e.enabled&&!b(e._lastCompleteTime)&&await function(e,t=-1){return new Promise((s=>{F().emitter.on(e,(e=>s(e))),-1!==t&&setTimeout(s,t)}))}(this.moduleName,3e5);const t=await this.getUserTaskProgress();if(t)if(-1!==t.is_surplus)if(3===t.day_task.status)this.config._lastCompleteTime=N(),this.status="done";else if(2===t.day_task.status){const e=await this.userTaskReceiveRewards();if(e){const t=e.num;t?this.logger.log(`领取奖励成功：${t}个电池`):this.logger.warn("领取奖励失败：未领取到电池"),this.config._lastCompleteTime=N(),this.status="done"}}else{let e=t.day_task.target-t.day_task.progress;for(;e>0;)await this.sendDanmu(`打卡${e}`,22474988),await _(2e3),e--;const s=await this.userTaskReceiveRewards();if(s){const e=s.num;e?this.logger.log(`领取奖励成功：${e}个电池`):this.logger.warn("领取奖励失败：未领取到电池"),this.config._lastCompleteTime=N(),this.status="done"}}else this.logger.log("今天APP用户任务的奖励已经没有了，明天早点来吧"),this.config._lastCompleteTime=N(),this.status="done"}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离APP用户任务模块下次运行时间:",e.str)}},DailyTask_LiveTask_DanmuTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.LiveTasks.danmu)}set status(e){this.moduleStore.moduleStatus.DailyTasks.LiveTasks.danmu=e}getRoomidList(){const e=w();return e.filteredFansMedals?e.filteredFansMedals.filter((e=>e.medal.level<20&&910884!=e.room_info.room_id)).map((e=>e.room_info.room_id)).slice(0,100):(this.status="error",null)}async sendDanmu(e,t){try{const s=await B.sendMsg(e,t);this.logger.log(`BAPI.live.sendMsg(${e}, ${t})`,s),0===s.code?this.logger.log(`在直播间 ${t} 发送弹幕 ${e} 成功`):this.logger.error(`在直播间 ${t} 发送弹幕 ${e} 失败`,s.message)}catch(s){this.logger.error(`在直播间 ${t} 发送弹幕 ${e} 出错`,s)}}async run(){if(this.logger.log("发送弹幕模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的发送弹幕任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过发送弹幕任务了"),this.status="done");else{this.status="running";const e=this.getRoomidList();if(e){const t=this.config.list;for(let s=0;s<e.length;s++){const i=t[s%t.length];await this.sendDanmu(i,e[s]),await _(2e3)}this.config._lastCompleteTime=N(),this.status="done",this.logger.log("发送弹幕任务已完成")}}this.moduleStore.emitter.emit("DailyTask_LiveTask_AppUserTask",{module:this.moduleName});const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离发送弹幕模块下次运行时间:",e.str)}},DailyTask_LiveTask_LikeTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.LiveTasks.like)}set status(e){this.moduleStore.moduleStatus.DailyTasks.LiveTasks.like=e}getRoomidUidList(){const e=w();return e.filteredFansMedals?e.filteredFansMedals.filter((e=>e.medal.level<20)).map((e=>[e.room_info.room_id,e.medal.target_id])).slice(0,100):(this.status="error",null)}async like(e,t){try{const s=await B.likeReport(e,t);this.logger.log(`BAPI.live.likeReport(${e}, ${t})`,s),0===s.code?this.logger.log(`给主播点赞 房间号 = ${e} 主播UID = ${t} 成功`):this.logger.error(`给主播点赞 房间号 = ${e} 主播UID = ${t} 失败`,s.message)}catch(s){this.logger.error(`给主播点赞 房间号 = ${e} 主播UID = ${t} 出错`,s)}}async run(){if(this.logger.log("给主播点赞模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的给主播点赞任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过给主播点赞任务了"),this.status="done");else{this.status="running";const e=this.getRoomidUidList();if(e){for(const[t,s]of e)await this.like(t,s),await _(2e3);this.config._lastCompleteTime=N(),this.status="done",this.logger.log("给主播点赞任务已完成")}}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离给主播点赞模块下次运行时间:",e.str)}},DailyTask_LiveTask_SignTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.LiveTasks.sign)}set status(e){this.moduleStore.moduleStatus.DailyTasks.LiveTasks.sign=e}async getSignInfo(){try{const e=await B.getSignInfo();return this.logger.log("BAPI.live.getSignInfo response",e),0===e.code?e.data:(this.logger.error("获取直播签到信息失败",e.message),null)}catch(e){return this.logger.error("获取直播签到信息出错",e),null}}async sign(){try{const e=await B.doSign();if(this.logger.log("BAPI.live.doSign response",e),0===e.code){this.logger.log("直播签到成功，获得奖励：",e.data.text),this.config._lastCompleteTime=N(),this.status="done",this.logger.log("直播签到任务已完成");const t=E(".checkin-btn");t&&t.remove()}else this.logger.error("直播签到失败",e.message),this.status="error"}catch(e){this.logger.error("执行直播签到任务出错",e),this.status="error"}}async run(){if(this.logger.log("直播签到模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的直播签到任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过直播签到任务了"),this.status="done");else{this.status="running";const e=await this.getSignInfo();e?0===e.status?await this.sign():(this.config._lastCompleteTime=N(),this.status="done"):await this.sign()}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离直播签到模块下次运行时间:",e.str)}},DailyTask_LiveTask_WatchTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.LiveTasks.watch)}set status(e){this.moduleStore.moduleStatus.DailyTasks.LiveTasks.watch=e}getRoomidUidList(){const e=w();return e.filteredFansMedals?e.filteredFansMedals.filter((e=>e.medal.level<20)).map((e=>[e.room_info.room_id,e.medal.target_id])).slice(0,100):null}async getAreaInfo(e){try{const t=await B.getInfoByRoom(e);if(this.logger.log(`BAPI.live.getInfoByRoom(${e}) response`,t),0===t.code){const e=t.data.room_info;return[e.area_id,e.parent_area_id]}return null}catch(t){return this.logger.error(`获取指定直播间的 area_id 和 parent_area_id(roomid = ${e}) 出错`,t),null}}async run(){if(this.logger.log("观看直播模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的观看直播任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过观看直播任务了"),this.status="done");else{this.status="running",b(this.config._lastWatchTime,0,0)?this.config._watchedSecondsToday-=this.config._watchedSecondsToday%300:this.config._watchedSecondsToday=0,this.config._lastWatchTime=N();const e=this.getRoomidUidList();if(e)for(let t=0;t<e.length;t++){const[s,i]=e[t],o=await this.getAreaInfo(s);o&&o.every((e=>e>0))&&new j(s,o[0],o[1],i,this.config._watchedSecondsToday,t===e.length-1).start(),await _(3e3)}}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离观看直播模块下次运行时间:",e.str)}},DailyTask_MainSiteTask_CoinTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks.coin),u(this,"MAX_COIN",1)}set status(e){this.moduleStore.moduleStatus.DailyTasks.MainSiteTasks.coin=e}getDynamicVideoIds(){const e=w();return s.isEmpty(e.dynamicVideos)?(this.status="error",null):e.dynamicVideos.map((e=>{const t=e.modules.module_dynamic.major.archive;return{aid:t.aid,bvid:t.bvid}}))}async getVideoCoinInfo(e,t){try{const s=await P.videoRelation(e,t);return this.logger.log(`BAPI.main.videoRelation(${e}, ${t}) response`,s),0===s.code?s.data.coin:(this.logger.error(`获取视频投币信息失败 aid = ${e} bvid = ${t}`,s.message),0)}catch(s){return this.logger.error(`获取视频投币信息出错 aid = ${e} bvid = ${t}`,s),0}}async coinDynamicVideos(e){const t=this.getDynamicVideoIds();if(t)for(const{aid:s,bvid:i}of t){const t=await this.getVideoCoinInfo(s,i),o=this.MAX_COIN-t;if(o>0){const t=Math.min(o,e),i=await this.coin(s,t);if(0===i){if(0===(e-=t)){this.logger.log("每日投币任务已完成"),this.config._lastCompleteTime=N(),this.status="done";break}}else if(1===i){this.status="error";break}}}}async coin(e,t){try{const s=await P.coinAdd(e,t);return this.logger.log(`BAPI.main.coinAdd(${e}) response`,s),0===s.code?(this.logger.log(`投币成功 视频aid = ${e} 投币数量num = ${t}`),0):-104===s.code?(this.logger.warn("硬币余额不足，每日投币任务终止"),1):(this.logger.error(`投币失败 视频aid = ${e} 投币数量num = ${t}`,s.message),2)}catch(s){return this.logger.error(`投币出错 视频aid = ${e} 投币数量num = ${t}`,s),3}}async run(){if(this.logger.log("每日投币模块开始运行"),this.config.enabled){const e=w();if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的每日投币任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过每日投币任务了"),this.status="done");else if(this.status="running",e.dailyRewardInfo){const t=e.dailyRewardInfo.coins/10;if(t<this.config.num){const e=this.config.num-t;e>(w().userInfo.money??5)?(this.logger.log("硬币余额不足，不执行每日投币任务"),this.status="done"):await this.coinDynamicVideos(e)}else this.config._lastCompleteTime=N(),this.status="done",this.logger.log("每日投币任务已完成")}}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离每日投币模块下次运行时间:",e.str)}},DailyTask_MainSiteTask_LoginTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks.login)}set status(e){this.moduleStore.moduleStatus.DailyTasks.MainSiteTasks.login=e}async login(){return this.logger.log("每日登录任务已完成"),this.config._lastCompleteTime=N(),this.status="done",Promise.resolve()}async run(){if(this.logger.log("每日登录模块开始运行"),this.config.enabled){const e=w();b(this.config._lastCompleteTime)?V(0,0,0,5)?this.logger.log("昨天的每日登录任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过每日登录任务了"),this.status="done"):(this.status="running",e.dailyRewardInfo&&!e.dailyRewardInfo.login?await this.login():(this.config._lastCompleteTime=N(),this.status="done"))}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离每日登录模块下次运行时间:",e.str)}},DailyTask_MainSiteTask_ShareTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks.share)}set status(e){this.moduleStore.moduleStatus.DailyTasks.MainSiteTasks.share=e}getAid(){const e=w();return s.isEmpty(e.dynamicVideos)?"2":e.dynamicVideos[0].modules.module_dynamic.major.archive.aid}async share(e){try{const t=await P.share(e);this.logger.log(`BAPI.main.share(${e}) response`,t),0===t.code||71e3===t.code?(this.logger.log("每日分享视频任务已完成"),this.config._lastCompleteTime=N(),this.status="done"):(this.logger.error("分享视频失败",t.message),this.status="error")}catch(e){this.logger.error("执行每日分享视频任务出错",e),this.status="error"}}async run(){if(this.logger.log("每日分享视频模块开始运行"),this.config.enabled){const e=w();if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的每日分享任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过每日分享任务了"),this.status="done");else if(this.status="running",e.dailyRewardInfo&&!e.dailyRewardInfo.share){const e=this.getAid();await this.share(e)}else this.config._lastCompleteTime=N(),this.status="done",this.logger.log("每日分享视频任务已完成")}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离每日分享视频模块下次运行时间:",e.str)}},DailyTask_MainSiteTask_WatchTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.MainSiteTasks.watch)}set status(e){this.moduleStore.moduleStatus.DailyTasks.MainSiteTasks.watch=e}getAid(){const e=w();return s.isEmpty(e.dynamicVideos)?"2":e.dynamicVideos[0].modules.module_dynamic.major.archive.aid}async watch(e){try{const t=await P.videoHeartbeat(e);this.logger.log(`BAPI.main.videoHeartbeat(${e}) response`,t),0===t.code?(this.logger.log("每日观看视频任务已完成"),this.config._lastCompleteTime=N(),this.status="done"):(this.logger.error("发送观看视频心跳失败",t.message),this.status="error")}catch(e){this.logger.error("执行每日观看视频任务出错",e),this.status="error"}}async run(){if(this.logger.log("每日观看视频模块开始运行"),this.config.enabled){const e=w();if(b(this.config._lastCompleteTime))V(0,0,0,5)?this.logger.log("昨天的每日观看视频任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过每日观看视频任务了"),this.status="done");else if(this.status="running",e.dailyRewardInfo&&!e.dailyRewardInfo.watch){const e=this.getAid();await this.watch(e)}else this.config._lastCompleteTime=N(),this.status="done",this.logger.log("每日观看视频任务已完成")}const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("距离每日观看视频模块下次运行时间:",e.str)}},DailyTask_OtherTask_CoinToSilver:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.OtherTasks.coinToSilver)}set status(e){this.moduleStore.moduleStatus.DailyTasks.OtherTasks.coinToSilver=e}async exchange(){try{const e=await B.coin2silver(this.config.num);this.logger.log(`BAPI.live.coin2silver{${this.config.num}} response`,e),0===e.code?(this.logger.log("硬币换银瓜子已完成，获得银瓜子:",e.data.silver),this.config._lastCompleteTime=N(),this.status="done"):(this.logger.error("硬币换银瓜子失败",e.message),this.status="error")}catch(e){this.logger.error("硬币换银瓜子出错",e),this.status="error"}}async run(){this.logger.log("硬币换银瓜子模块开始运行"),this.config.enabled&&(b(this.config._lastCompleteTime)?V(0,0,0,5)?this.logger.log("昨天的硬币换银瓜子任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过硬币换银瓜子任务了"),this.status="done"):(this.status="running",await this.exchange()));const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("硬币换银瓜子模块下次运行时间:",e.str)}},DailyTask_OtherTask_GroupSignTask:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.OtherTasks.groupSign)}set status(e){this.moduleStore.moduleStatus.DailyTasks.OtherTasks.groupSign=e}async getGroupidOwneruidList(){try{const e=await M.myGroups();if(this.logger.log("BAPI.vc.myGroups response",e),0===e.code)return e.data.list.map((e=>[e.group_id,e.owner_uid]));this.logger.error("获取应援团信息失败",e.message),this.status="error"}catch(e){this.logger.error("获取应援团信息出错",e),this.status="error"}}async sign(e,t){try{const s=await M.signIn(e,t);this.logger.log(`BAPI.vc.signIn(${e}, ${t}) response`,s),0===s.code?this.logger.log(`应援团签到 应援团ID = ${e} 拥有者UID = ${t} 成功, 粉丝勋章亲密度+${s.data.add_num}`):this.logger.error(`应援团签到 应援团ID = ${e} 拥有者UID = ${t} 失败`,s.message)}catch(s){this.logger.error(`应援团签到 应援团ID = ${e} 拥有者UID = ${t} 出错`,s)}}async run(){if(this.logger.log("应援团签到模块开始运行"),this.config.enabled)if(b(this.config._lastCompleteTime,8,5))V(0,0,8,5)?this.logger.log("昨天的应援团签到任务已经完成过了，等到今天早上八点零五分再次执行"):(this.logger.log("今天已经完成过应援团签到任务了"),this.status="done");else{this.status="running";const e=await this.getGroupidOwneruidList();if(e){for(const[t,s]of e)await this.sign(t,s),await _(2e3);this.config._lastCompleteTime=N(),this.logger.log("应援团签到任务已完成"),this.status="done"}}const e=C(8,5);setTimeout((()=>this.run()),e.ms),this.logger.log("距离应援团签到模块下次运行时间:",e.str)}},DailyTask_OtherTask_SilverToCoin:class extends A{constructor(){super(...arguments),u(this,"config",this.moduleStore.moduleConfig.DailyTasks.OtherTasks.silverToCoin)}set status(e){this.moduleStore.moduleStatus.DailyTasks.OtherTasks.silverToCoin=e}async exchange(){try{const e=await B.silver2coin();this.logger.log("BAPI.live.silver2coin response",e),0===e.code?(this.logger.log("银瓜子换硬币已完成，获得硬币1个"),this.config._lastCompleteTime=N(),this.status="done"):403===e.code?(this.logger.log("每天最多只能用银瓜子兑换1个硬币"),this.config._lastCompleteTime=N(),this.status="done"):(this.logger.error("银瓜子换硬币失败",e.message),this.status="error")}catch(e){this.logger.error("银瓜子换硬币出错",e),this.status="error"}}async run(){this.logger.log("银瓜子换硬币模块开始运行"),this.config.enabled&&(b(this.config._lastCompleteTime)?V(0,0,0,5)?this.logger.log("昨天的银瓜子换硬币任务已经完成过了，等到今天的00:05再执行"):(this.logger.log("今天已经完成过银瓜子换硬币任务了"),this.status="done"):(this.status="running",await this.exchange()));const e=C();setTimeout((()=>this.run()),e.ms),this.logger.log("银瓜子换硬币模块下次运行时间:",e.str)}}},Symbol.toStringTag,{value:"Module"}));const H={DailyTasks:{MainSiteTasks:{login:"",watch:"",coin:"",share:""},LiveTasks:{sign:"",danmu:"",like:"",watch:"",appUser:""},OtherTasks:{groupSign:"",silverToCoin:"",coinToSilver:""}}},F=t.defineStore("module",(()=>{const t=e.reactive(v.getModuleConfig()),i=[],o={all:a=a||new Map,on:function(e,t){var s=a.get(e);s?s.push(t):a.set(e,[t])},off:function(e,t){var s=a.get(e);s&&(t?s.splice(s.indexOf(t)>>>0,1):a.set(e,[]))},emit:function(e,t){var s=a.get(e);s&&s.slice().map((function(e){e(t)})),(s=a.get("*"))&&s.slice().map((function(s){s(e,t)}))}};var a;const n=e.reactive(H);return e.watch(t,s.debounce((e=>v.setModuleConfig(e)),250,{leading:!0,trailing:!0})),function e(){setTimeout((()=>{x(n,((e,t)=>{s.set(n,t,"")})),e()}),C(0,0).ms)}(),{moduleConfig:t,runningModules:i,emitter:o,moduleStatus:n,loadModules:async function(){for(const[e,t]of Object.entries(R).sort(((e,t)=>e[1].sequence-t[1].sequence))){const s=new t(e);i.push(s);try{await s.run()}catch(e){return void new $("loadModules").error("加载默认模块时发生错误，挂机助手停止运行:",e)}}for(const[e,t]of Object.entries(z)){const s=new t(e);i.push(s),s.run()}}}})),G={class:"title"},q=(e,t)=>{const s=e.__vccOpts||e;for(const[e,i]of t)s[e]=i;return s},J=q(e.defineComponent({__name:"PanelHeader",setup(t){const s=T();return(t,i)=>{const o=e.resolveComponent("el-icon"),n=e.resolveComponent("el-text");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",{class:"collapse-btn",onClick:i[0]||(i[0]=t=>e.unref(s).changeCollapse())},[e.unref(s).uiConfig.isCollapse?(e.openBlock(),e.createBlock(o,{key:0},{default:e.withCtx((()=>[e.createVNode(e.unref(a.Expand))])),_:1})):(e.openBlock(),e.createBlock(o,{key:1},{default:e.withCtx((()=>[e.createVNode(e.unref(a.Fold))])),_:1}))]),e.createElementVNode("div",G,[e.createVNode(n,{tag:"b",class:"header-big-text"},{default:e.withCtx((()=>[e.createTextVNode("控制面板")])),_:1}),e.createVNode(n,{class:"header-small-text"},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(e.unref(s).activeMenuName),1)])),_:1})])],64)}}}),[["__scopeId","data-v-dda95e10"]]),K=e.defineComponent({__name:"PanelAside",setup(t){const s=T(),i=[{icon:"Tasks",title:"每日任务",index:"DailyTasks",subs:[{title:"主站任务",index:"MainSiteTasks"},{title:"直播任务",index:"LiveTasks"},{title:"其它任务",index:"OtherTasks"}]}];return(t,o)=>{const a=e.resolveComponent("el-icon"),n=e.resolveComponent("el-menu-item"),l=e.resolveComponent("el-sub-menu"),r=e.resolveComponent("el-menu");return e.openBlock(),e.createBlock(r,{"default-active":e.unref(s).uiConfig.activeMenuIndex,style:e.normalizeStyle({"min-height":e.unref(s).scrollBarHeight}),collapse:e.unref(s).uiConfig.isCollapse,"unique-opened":"",onSelect:e.unref(s).setActiveMenuIndex,id:"aside-el-menu"},{default:e.withCtx((()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(i,(t=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[t.subs?(e.openBlock(),e.createBlock(l,{index:t.index,key:t.index},{title:e.withCtx((()=>[e.createVNode(a,null,{default:e.withCtx((()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.icon)))])),_:2},1024),e.createElementVNode("span",null,e.toDisplayString(t.title),1)])),default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.subs,(t=>(e.openBlock(),e.createBlock(n,{key:t.index,index:t.index},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.title),1)])),_:2},1032,["index"])))),128))])),_:2},1032,["index"])):(e.openBlock(),e.createBlock(n,{index:t.index,key:t.index},{title:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.title),1)])),default:e.withCtx((()=>[e.createVNode(a,null,{default:e.withCtx((()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.icon)))])),_:2},1024)])),_:2},1032,["index"]))],64)))),64))])),_:1},8,["default-active","style","collapse","onSelect"])}}}),X=e.defineComponent({__name:"MainSiteTasks",setup(t){const s=F(),i=s.moduleConfig.DailyTasks.MainSiteTasks,o=s.moduleStatus.DailyTasks.MainSiteTasks;return(t,s)=>{const a=e.resolveComponent("el-switch"),n=e.resolveComponent("Info"),l=e.resolveComponent("TaskStatus"),r=e.resolveComponent("el-space"),c=e.resolveComponent("el-row"),d=e.resolveComponent("el-option"),u=e.resolveComponent("el-select"),h=e.resolveComponent("el-text"),g=e.resolveComponent("el-divider"),m=e.resolveComponent("el-link");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).login.enabled,"onUpdate:modelValue":s[0]||(s[0]=t=>e.unref(i).login.enabled=t),"active-text":"每日登录"},null,8,["modelValue"]),e.createVNode(n,{id:"DailyTasks.MainSiteTasks.login"}),e.createVNode(l,{status:e.unref(o).login},null,8,["status"])])),_:1})])),_:1}),e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).watch.enabled,"onUpdate:modelValue":s[1]||(s[1]=t=>e.unref(i).watch.enabled=t),"active-text":"每日观看视频"},null,8,["modelValue"]),e.createVNode(n,{id:"DailyTasks.MainSiteTasks.watch"}),e.createVNode(l,{status:e.unref(o).watch},null,8,["status"])])),_:1})])),_:1}),e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).coin.enabled,"onUpdate:modelValue":s[2]||(s[2]=t=>e.unref(i).coin.enabled=t),"active-text":"每日投币"},null,8,["modelValue"]),e.createVNode(u,{modelValue:e.unref(i).coin.num,"onUpdate:modelValue":s[3]||(s[3]=t=>e.unref(i).coin.num=t),placeholder:"Select",style:{width:"64px"}},{default:e.withCtx((()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(t=>e.createVNode(d,{key:t,label:t,value:t},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),e.createVNode(h,null,{default:e.withCtx((()=>[e.createTextVNode("个")])),_:1}),e.createVNode(n,{id:"DailyTasks.MainSiteTasks.coin"}),e.createVNode(l,{status:e.unref(o).coin},null,8,["status"])])),_:1})])),_:1}),e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).share.enabled,"onUpdate:modelValue":s[4]||(s[4]=t=>e.unref(i).share.enabled=t),"active-text":"每日分享视频"},null,8,["modelValue"]),e.createVNode(n,{id:"DailyTasks.MainSiteTasks.share"}),e.createVNode(l,{status:e.unref(o).share},null,8,["status"])])),_:1})])),_:1}),e.createVNode(g),e.createElementVNode("div",null,[e.createVNode(h,null,{default:e.withCtx((()=>[e.createTextVNode("  主站每日任务的完成情况可在")])),_:1}),e.createVNode(m,{class:"el-link-va-baseline",rel:"noreferrer",type:"primary",href:"https://account.bilibili.com/account/home",target:"_blank"},{default:e.withCtx((()=>[e.createTextVNode("个人中心")])),_:1}),e.createVNode(h,null,{default:e.withCtx((()=>[e.createTextVNode("查看。数据更新可能有一定的延时。")])),_:1})])])}}}),W=e.createElementVNode("br",null,null,-1),Z={components:{MainSiteTasks:X,LiveTasks:e.defineComponent({__name:"LiveTasks",setup(t){const s=F(),i=s.moduleConfig.DailyTasks.LiveTasks,o=s.moduleStatus.DailyTasks.LiveTasks,l=e.ref(!1),r=e.computed((()=>i.danmu.list.map((e=>({content:e}))))),c=()=>{n.ElMessageBox.prompt("请输入新增的弹幕内容","新增弹幕",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^.{1,30}$/,inputErrorMessage:"弹幕内容不得为空且长度不能超过30",lockScroll:!1}).then((({value:e})=>{i.danmu.list.push(e)})).catch((()=>{}))};return(t,s)=>{const d=e.resolveComponent("el-switch"),u=e.resolveComponent("Info"),h=e.resolveComponent("TaskStatus"),g=e.resolveComponent("el-space"),m=e.resolveComponent("el-row"),f=e.resolveComponent("el-button"),p=e.resolveComponent("el-option"),v=e.resolveComponent("el-select"),T=e.resolveComponent("el-text"),w=e.resolveComponent("el-divider"),k=e.resolveComponent("el-link"),_=e.resolveComponent("el-table-column"),y=e.resolveComponent("el-table"),x=e.resolveComponent("el-dialog");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(g,{wrap:""},{default:e.withCtx((()=>[e.createVNode(d,{modelValue:e.unref(i).sign.enabled,"onUpdate:modelValue":s[0]||(s[0]=t=>e.unref(i).sign.enabled=t),"active-text":"直播签到"},null,8,["modelValue"]),e.createVNode(u,{id:"DailyTasks.LiveTasks.sign"}),e.createVNode(h,{status:e.unref(o).sign},null,8,["status"])])),_:1})])),_:1}),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(g,{wrap:""},{default:e.withCtx((()=>[e.createVNode(d,{modelValue:e.unref(i).like.enabled,"onUpdate:modelValue":s[1]||(s[1]=t=>e.unref(i).like.enabled=t),"active-text":"给主播点赞"},null,8,["modelValue"]),e.createVNode(u,{id:"DailyTasks.LiveTasks.like"}),e.createVNode(h,{status:e.unref(o).like},null,8,["status"])])),_:1})])),_:1}),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(g,{wrap:""},{default:e.withCtx((()=>[e.createVNode(d,{modelValue:e.unref(i).danmu.enabled,"onUpdate:modelValue":s[2]||(s[2]=t=>e.unref(i).danmu.enabled=t),"active-text":"发送弹幕"},null,8,["modelValue"]),e.createVNode(f,{type:"primary",size:"small",icon:e.unref(a.Edit),onClick:s[3]||(s[3]=e=>l.value=!l.value)},{default:e.withCtx((()=>[e.createTextVNode("编辑弹幕")])),_:1},8,["icon"]),e.createVNode(u,{id:"DailyTasks.LiveTasks.danmu"}),e.createVNode(h,{status:e.unref(o).danmu},null,8,["status"])])),_:1})])),_:1}),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(g,{wrap:""},{default:e.withCtx((()=>[e.createVNode(d,{modelValue:e.unref(i).watch.enabled,"onUpdate:modelValue":s[4]||(s[4]=t=>e.unref(i).watch.enabled=t),"active-text":"观看直播"},null,8,["modelValue"]),e.createVNode(v,{modelValue:e.unref(i).watch.time,"onUpdate:modelValue":s[5]||(s[5]=t=>e.unref(i).watch.time=t),placeholder:"Select",style:{width:"64px"}},{default:e.withCtx((()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(24,(t=>e.createVNode(p,{key:t,label:5*t,value:5*t},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),e.createVNode(T,null,{default:e.withCtx((()=>[e.createTextVNode("分钟")])),_:1}),e.createVNode(u,{id:"DailyTasks.LiveTasks.watch"}),e.createVNode(h,{status:e.unref(o).watch},null,8,["status"])])),_:1})])),_:1}),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(g,{wrap:""},{default:e.withCtx((()=>[e.createVNode(d,{modelValue:e.unref(i).appUser.enabled,"onUpdate:modelValue":s[6]||(s[6]=t=>e.unref(i).appUser.enabled=t),"active-text":"APP用户任务"},null,8,["modelValue"]),e.createVNode(u,{id:"DailyTasks.LiveTasks.appUser"}),e.createVNode(h,{status:e.unref(o).appUser},null,8,["status"])])),_:1})])),_:1}),e.createVNode(w),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(T,null,{default:e.withCtx((()=>[e.createTextVNode("直播任务相关信息可在")])),_:1}),e.createVNode(k,{class:"el-link-va-baseline",rel:"noreferrer",type:"primary",href:"https://link.bilibili.com/p/help/index#/audience-fans-medal",target:"_blank"},{default:e.withCtx((()=>[e.createTextVNode("帮助中心")])),_:1}),e.createVNode(T,null,{default:e.withCtx((()=>[e.createTextVNode("查看。")])),_:1})])),_:1}),W,e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(T,{tag:"b"},{default:e.withCtx((()=>[e.createTextVNode("注意：")])),_:1})])),_:1}),e.createVNode(m,null,{default:e.withCtx((()=>[e.createVNode(T,null,{default:e.withCtx((()=>[e.createTextVNode("  由于每天能通过完成任务获得亲密度的粉丝勋章数量有限，目前脚本仅尝试为前100个等级小于20的粉丝勋章完成给主播点赞，发送弹幕，观看直播任务。")])),_:1})])),_:1}),e.createVNode(x,{modelValue:l.value,"onUpdate:modelValue":s[7]||(s[7]=e=>l.value=e),title:"编辑弹幕内容","lock-scroll":!1,width:"40%"},{footer:e.withCtx((()=>[e.createVNode(f,{type:"primary",onClick:c},{default:e.withCtx((()=>[e.createTextVNode("新增弹幕")])),_:1})])),default:e.withCtx((()=>[e.createVNode(y,{ref:"singleTableRef",data:r.value,"max-height":"500"},{default:e.withCtx((()=>[e.createVNode(_,{type:"index",width:"50"}),e.createVNode(_,{prop:"content",label:"弹幕内容"}),e.createVNode(_,{label:"操作",width:"220",align:"center"},{default:e.withCtx((t=>[e.createVNode(f,{text:"",icon:e.unref(a.Edit),onClick:e=>{return s=t.$index,o=t.row,void n.ElMessageBox.prompt("请输入新的弹幕内容","修改弹幕",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^.{1,30}$/,inputErrorMessage:"弹幕内容不得为空且长度不能超过30",inputValue:o.content,lockScroll:!1}).then((({value:e})=>{i.danmu.list[s]=e})).catch((()=>{}));var s,o}},{default:e.withCtx((()=>[e.createTextVNode(" 修改 ")])),_:2},1032,["icon","onClick"]),e.createVNode(f,{text:"",icon:e.unref(a.Delete),type:"danger",onClick:e=>{return s=t.$index,void(1!==i.danmu.list.length?i.danmu.list.splice(s,1):n.ElMessage.warning({message:"至少要有一条弹幕",appendTo:".el-dialog"}));var s}},{default:e.withCtx((()=>[e.createTextVNode(" 删除 ")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}}),OtherTasks:e.defineComponent({__name:"OtherTasks",setup(t){const s=F(),i=s.moduleConfig.DailyTasks.OtherTasks,o=s.moduleStatus.DailyTasks.OtherTasks;return(t,s)=>{const a=e.resolveComponent("el-switch"),n=e.resolveComponent("Info"),l=e.resolveComponent("TaskStatus"),r=e.resolveComponent("el-space"),c=e.resolveComponent("el-row"),d=e.resolveComponent("el-text"),u=e.resolveComponent("el-option"),h=e.resolveComponent("el-select"),g=e.resolveComponent("el-divider");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).groupSign.enabled,"onUpdate:modelValue":s[0]||(s[0]=t=>e.unref(i).groupSign.enabled=t),"active-text":"应援团签到"},null,8,["modelValue"]),e.createVNode(n,{id:"DailyTasks.OtherTasks.groupSign"}),e.createVNode(l,{status:e.unref(o).groupSign},null,8,["status"])])),_:1})])),_:1}),e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).silverToCoin.enabled,"onUpdate:modelValue":s[1]||(s[1]=t=>e.unref(i).silverToCoin.enabled=t),"active-text":"银瓜子换硬币"},null,8,["modelValue"]),e.createVNode(n,{id:"DailyTasks.OtherTasks.silverToCoin"}),e.createVNode(l,{status:e.unref(o).silverToCoin},null,8,["status"])])),_:1})])),_:1}),e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{wrap:""},{default:e.withCtx((()=>[e.createVNode(a,{modelValue:e.unref(i).coinToSilver.enabled,"onUpdate:modelValue":s[2]||(s[2]=t=>e.unref(i).coinToSilver.enabled=t),"active-text":"硬币换银瓜子"},null,8,["modelValue"]),e.createVNode(d,null,{default:e.withCtx((()=>[e.createTextVNode("花费硬币")])),_:1}),e.createVNode(h,{modelValue:e.unref(i).coinToSilver.num,"onUpdate:modelValue":s[3]||(s[3]=t=>e.unref(i).coinToSilver.num=t),placeholder:"Select",style:{width:"64px"}},{default:e.withCtx((()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(50,(t=>e.createVNode(u,{key:t,label:t,value:t},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),e.createVNode(d,null,{default:e.withCtx((()=>[e.createTextVNode("个")])),_:1}),e.createVNode(n,{id:"DailyTasks.OtherTasks.coinToSilver"}),e.createVNode(l,{status:e.unref(o).coinToSilver},null,8,["status"])])),_:1})])),_:1}),e.createVNode(g)])}}})}},Y=e.defineComponent({...Z,__name:"PanelMain",setup(t){const s=T();return(t,i)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(s).uiConfig.activeMenuIndex)))}}),Q=q(e.defineComponent({__name:"App",setup(t){const i=T(),o=F();let a,n,r=i.uiConfig.isShowPanel;function c(){const e=a.getBoundingClientRect();i.baseStyleValue.top=e.top+window.scrollY,i.baseStyleValue.left=e.left+window.scrollX,i.baseStyleValue.height=e.height,i.baseStyleValue.width=.4*e.width}i.uiConfig.isShowPanel=!1;const d=s.throttle((function(){i.changeShowPanel(),n.innerText=i.isShowPanelButtonText}),300);return o.loadModules(),window.onload=()=>{if(a=E("#live-player-ctnr"),a){c(),(e=document,t=".left-ctnr.left-header-area",s=300,o=3e3,new Promise(((i,a)=>{const n=setInterval((()=>{const s=e.querySelector(t);s&&(clearTimeout(n),i(s))}),s),l=setTimeout((()=>{clearTimeout(n),clearTimeout(l),a()}),o)}))).then((e=>{var t;n=U("button"),n.setAttribute("class","blth_btn"),n.onclick=d,n.innerText=i.isShowPanelButtonText,e.append(n),f.self!==f.top&&l("alt+b",{element:null==(t=f.top)?void 0:t.document},d),l("alt+b",d)})).catch((()=>console.error("Can't find playerHeaderLeft in time"))),window.onresize=c;const a=new MutationObserver((()=>c()));a.observe(document.documentElement,{attributes:!0}),a.observe(document.body,{attributes:!0}),r&&(i.uiConfig.isShowPanel=!0)}else console.error("livePlayer not found");var e,t,s,o},(t,s)=>{const o=e.resolveComponent("el-header"),a=e.resolveComponent("el-aside"),n=e.resolveComponent("el-main"),l=e.resolveComponent("el-container"),r=e.resolveComponent("el-scrollbar"),c=e.resolveComponent("el-collapse-transition");return e.openBlock(),e.createBlock(c,null,{default:e.withCtx((()=>[e.withDirectives(e.createElementVNode("div",{style:e.normalizeStyle(e.unref(i).baseStyle),class:"base"},[e.createVNode(l,null,{default:e.withCtx((()=>[e.createVNode(o,{class:"header"},{default:e.withCtx((()=>[e.createVNode(J)])),_:1}),e.createVNode(r,{height:e.unref(i).scrollBarHeight},{default:e.withCtx((()=>[e.createVNode(l,null,{default:e.withCtx((()=>[e.createVNode(a,{class:"aside"},{default:e.withCtx((()=>[e.createVNode(K)])),_:1}),e.createVNode(n,{class:"main"},{default:e.withCtx((()=>[(e.openBlock(),e.createBlock(e.KeepAlive,null,[e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx((()=>[e.createVNode(Y)])),_:1})],1024))])),_:1})])),_:1})])),_:1},8,["height"])])),_:1})],4),[[e.vShow,e.unref(i).uiConfig.isShowPanel]])])),_:1})}}}),[["__scopeId","data-v-64fce103"]]);(e=>{const t=GM_getResourceText(e),s=document.createElement("style");s.innerText=t,document.head.append(s)})("element-plus/dist/index.css");const ee={},te={xmlns:"http://www.w3.org/2000/svg",width:"128",height:"128",class:"icon",viewBox:"0 0 1024 1024"},se=[e.createElementVNode("path",{d:"M831.825 63.94H191.94c-70.692 0-128 57.308-128 128v639.885c0 70.692 57.308 128 128 128h639.885c70.692 0 128-57.308 128-128V191.94c0-70.692-57.308-128-128-128zM895.885 832a63.835 63.835 0 0 1-63.973 63.886H192.088c-17.112 0-33.27-6.575-45.372-18.676S127.88 849.112 127.88 832V192a64.236 64.236 0 0 1 64.208-64.12h639.824A64.038 64.038 0 0 1 895.885 192v640z"},null,-1),e.createElementVNode("path",{d:"M791.998 351.852H536a31.97 31.97 0 0 0 0 63.94h256a31.97 31.97 0 0 0 0-63.94zm0 256.121H536a31.97 31.97 0 0 0 0 63.94h256a31.97 31.97 0 0 0 0-63.94zm-447.996-79.975c-61.856 0-111.986 50.144-111.986 111.985S282.16 751.97 344.002 751.97s111.985-50.144 111.985-111.986-50.13-111.985-111.985-111.985zm33.982 145.982a48.045 48.045 0 1 1 14.088-33.982 47.746 47.746 0 0 1-14.088 33.986zm39.412-376.586L311.999 402.787l-41.391-41.395a31.97 31.97 0 1 0-45.213 45.213l63.997 64.002a31.97 31.97 0 0 0 45.214 0l128-128a31.97 31.97 0 0 0-45.21-45.213z"},null,-1)];const ie=q(ee,[["render",function(t,s){return e.openBlock(),e.createElementBlock("svg",te,se)}]]),oe={DailyTasks:{MainSiteTasks:{login:{title:"每日登录",message:"完成主站的每日登录任务。"},watch:{title:"每日观看视频",message:e.h("p",[e.h("div","完成主站的每日观看视频任务。"),e.h("div","从动态中选取视频观看，会产生观看历史记录。")])},coin:{title:"每日投币",message:e.h("p",[e.h("div","完成主站的每日投币任务。"),e.h("div","从动态中选取视频投币，会根据你今天已经投过的币的数量计算还要投几个币。")])},share:{title:"每日分享视频",message:e.h("p",[e.h("div","完成主站的每日分享视频任务。"),e.h("div","不会真的分享到某处。")])}},LiveTasks:{sign:{title:"直播签到",message:e.h("p",[e.h("div","完成直播签到任务。"),e.h("div","完成后会移除当前直播间右上角签到窗口中的签到按钮。")])},like:{title:"给主播点赞",message:e.h("p",[e.h("div","在你的每个粉丝勋章对应的直播间给主播点赞。"),e.h("div","部分直播间无法完成该任务，原因未知。")])},danmu:{title:"发送弹幕",message:e.h("p",[e.h("div","在你的每个粉丝勋章对应的直播间发送一条弹幕。"),e.h("div",[e.h("span","点击编辑弹幕按钮编辑发送的弹幕，脚本会从中按顺序循环抽取弹幕发送。"),e.h("span","部分直播间无法完成该任务，可能的原因有:，"),e.h("li","你被禁言了"),e.h("li","发言有粉丝勋章等级要求"),e.h("li",[e.h("span","特殊直播间（比如"),e.h("a",{href:"https://live.bilibili.com/54",rel:"noreferrer",target:"_blank"},"54"),e.h("span","）")])])])},watch:{title:"观看直播",message:e.h("p",[e.h("div","完成观看持有粉丝勋章对应主播直播的任务。"),e.h("div","部分直播间因为没有设置直播分区导致任务无法完成。主播当前是否开播不会影响该任务的完成。")])},appUser:{title:"APP用户任务",message:e.h("p",[e.h("div","完成APP用户任务并领取奖励。"),e.h("div",[e.h("span","在APP中观看直播时右下角可能会有个电池图标，点击即可查看APP用户任务内容。并非所有账号都可以参加该任务。如果开启了发送弹幕功能，该功能会在发送弹幕功能运行完毕后再运行。如果之前发送的弹幕数量不够，会先在直播间"),e.h("a",{class:"el-link el-link--primary is-underline el-link-va-baseline",href:"https://live.bilibili.com/22474988",rel:"noreferrer",target:"_blank"},"22474988"),e.h("span","发送弹幕再领取奖励。")])])}},OtherTasks:{groupSign:{title:"应援团签到",message:"完成应援团签到任务。"},silverToCoin:{title:"银瓜子换硬币",message:e.h("p",[e.h("div","把银瓜子兑换为硬币。"),e.h("div","具体兑换规则请点击直播间页面的“立即充值→银瓜子商店”查看。")])},coinToSilver:{title:"硬币换银瓜子",message:e.h("p",[e.h("div","把硬币兑换为银瓜子。"),e.h("div","具体兑换规则请点击直播间页面的“立即充值→银瓜子商店”查看。")])}}}},ae=(t=>(e.pushScopeId("data-v-c1d8df5e"),t=t(),e.popScopeId(),t))((()=>e.createElementVNode("svg",{xmlns:"http://www.w3.org/2000/svg",width:"128",height:"128",class:"icon",viewBox:"0 0 1024 1024"},[e.createElementVNode("path",{fill:"#276BC0",d:"M512.67 959.47c-246.343 0-446.76-200.632-446.76-447.24S266.326 64.98 512.67 64.98s446.76 200.642 446.76 447.25-200.416 447.24-446.76 447.24zm0-829.04c-210.291 0-381.38 171.283-381.38 381.8s171.089 381.79 381.38 381.79 381.381-171.273 381.381-381.79-171.09-381.8-381.38-381.8z"}),e.createElementVNode("path",{fill:"#276BC0",d:"M447.29 317.172a63.891 63.959 0 1 0 130.76 0 63.891 63.959 0 1 0-130.76 0Zm64.907 503.047c-30.093 0-54.235-24.416-54.235-54.541V482.062c0-30.126 24.142-54.541 54.235-54.541 30.094 0 54.236 24.416 54.236 54.541v283.616c0 30.125-24.142 54.54-54.236 54.54z"})],-1))),ne=q(e.defineComponent({__name:"InfoIcon",props:{id:{}},setup(t){const i=t,o=()=>{const{title:e,message:t}=s.get(oe,i.id,{title:"无",message:"无"});n.ElMessageBox({title:e,message:t,lockScroll:!1,autofocus:!0,confirmButtonText:"OK"})};return(t,s)=>{const i=e.resolveComponent("el-icon");return e.openBlock(),e.createBlock(i,{class:"info-icon",onClick:o},{default:e.withCtx((()=>[ae])),_:1})}}}),[["__scopeId","data-v-c1d8df5e"]]),le=q(e.defineComponent({__name:"TaskStatusIcon",props:{status:{}},setup:t=>(t,s)=>{const i=e.resolveComponent("Loading"),o=e.resolveComponent("el-icon"),a=e.resolveComponent("Select"),n=e.resolveComponent("CloseBold");return"running"===t.status?(e.openBlock(),e.createBlock(o,{key:0,class:"status-icon is-loading"},{default:e.withCtx((()=>[e.createVNode(i)])),_:1})):"done"===t.status?(e.openBlock(),e.createBlock(o,{key:1,class:"status-icon",style:{color:"#1ab059"}},{default:e.withCtx((()=>[e.createVNode(a)])),_:1})):"error"===t.status?(e.openBlock(),e.createBlock(o,{key:2,class:"status-icon",style:{color:"#ff6464"}},{default:e.withCtx((()=>[e.createVNode(n)])),_:1})):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-2f9d6050"]]),re=Object.freeze(Object.defineProperty({__proto__:null,Info:ne,TaskStatus:le,Tasks:ie},Symbol.toStringTag,{value:"Module"}));if(f.BilibiliLive){const s=e.createApp(Q),i=t.createPinia();s.use(n),s.use(i);for(const[e,t]of Object.entries(c))s.component(e,t);for(const[e,t]of Object.entries(re))s.component(e,t);s.mount((()=>{const e=U("div");return e.id="BLTH",document.body.append(e),e})())}}(Vue,Pinia,_,luxon,CryptoJS,ElementPlusIconsVue,ElementPlus,hotkeys);
